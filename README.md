마사몽 AI 챗봇: 지능적 상호작용 디스코드 봇
마사몽은 단순한 명령어 봇을 넘어, 서버의 대화에 자연스럽게 참여하고 사용자의 의도를 파악하여 정보를 제공하는 지능형 AI 챗봇입니다. '마사몽'이라는 독특한 페르소나를 바탕으로 서버 멤버들과 유대감을 형성하고, 커뮤니티에 활기를 불어넣는 것을 목표로 합니다.

🤖 봇의 핵심 컨셉
마사몽은 다음과 같은 핵심 기술을 통해 지능적인 상호작용을 구현합니다.

AI 기반 페르소나: '마사몽'은 단순한 정보 제공자가 아닌, 독특한 말투와 성격을 가진 서버의 일원입니다. 모든 답변은 이 페르소나를 기반으로 생성되어 사용자에게 일관되고 재미있는 경험을 제공합니다.

다층적 AI 의사결정: 봇은 여러 단계의 AI 판단을 거쳐 행동합니다. 가볍고 빠른 '분석용 AI'가 먼저 사용자의 의도나 대화의 맥락을 파악하고, 그 판단에 따라 고품질의 '답변 생성용 AI'가 최종 응답을 만들어내는 효율적인 구조를 가집니다.

자발적 대화 참여: 봇은 @멘션으로 호출될 때만 응답하는 수동적인 존재가 아닙니다. 대화의 흐름을 지켜보다가 자신과 관련된 키워드가 나오면, '눈치 보는 AI'의 판단을 거쳐 자연스럽게 대화에 참여합니다.

문맥 기억 (단기 기억): 각 채널의 최근 대화를 기억하고 있어, 사용자의 이전 발언을 참고하여 맥락에 맞는 답변을 생성할 수 있습니다.

✨ 주요 기능 및 사용법
마사몽은 정보 제공, 엔터테인먼트, 커뮤니티 활성화 등 다양한 기능을 제공합니다.

1. 지능형 AI 채팅
멘션 응답: @마사몽으로 봇을 직접 호출하여 질문하거나 대화를 나눌 수 있습니다.

사용 예시: @마사몽 오늘 날씨 어때? 또는 @마사몽 심심한데 재밌는 얘기 해줘.

자발적 응답: 사용자들이 멘션 없이 대화하다가 "마사몽", "봇" 등 관련 키워드를 언급하면, 봇이 상황을 판단하여 스스로 대화에 참여합니다.

사용 예시: (사용자 A) "어제 마사몽 답변 좀 웃겼어 ㅋㅋ" → (마사몽) "내가 좀 웃기지. 뭘 새삼스럽게."

2. 날씨 정보 (AI 연동)
설명: "날씨"라는 키워드 없이도, 사용자의 대화 맥락을 파악하여 날씨 정보를 알려줍니다.

사용 예시:

@마사몽 오늘 너무 덥다 → (마사몽) "인정. 지금 광양 32도래. 익어버릴 듯."

@마사몽 내일 비 온대? → (마사몽) "ㅇㅇ 내일 비 올 확률 70%니까 우산 챙겨라."

주기적 알림: 설정된 시간에 아침/저녁 인사와 함께 날씨 정보를 브리핑해주거나, 비/눈 예보가 있을 때 미리 알려줍니다.

3. 재미 기능 (명령어 & 키워드)
오늘의 운세

설명: '마사몽'의 페르소나로 재치있는 오늘의 운세를 알려줍니다.

명령어: !운세

키워드: "오늘 운세", "운세 좀 봐줘" 등

대화 요약

설명: 최근 대화 내용을 AI가 3줄로 요약해줍니다.

명령어: !요약

키워드: "무슨 얘기했어", "요약 좀" 등

4. 커뮤니티 기능
활동 랭킹

설명: 서버 내 메시지 작성 빈도를 기준으로 '수다왕' 랭킹을 보여줍니다.

명령어: !랭킹, !수다왕

간단한 투표

설명: 간단한 주제에 대해 투표를 생성합니다.

명령어: !투표 "질문" "항목1" "항목2" ... (항목은 최대 10개)

사용 예시: !투표 "오늘 점심 메뉴는?" "짜장면" "짬뽕"

5. 관리 및 로깅
구조화된 로그: 모든 활동은 discord_logs.txt 파일에 체계적인 JSON 형식으로 기록되어 문제 추적 및 분석이 용이합니다.

로그 파일 관리: 관리자는 !로그삭제 명령어를 통해 로그 파일을 수동으로 삭제할 수 있습니다.

🛠️ 설치 및 설정
1. 사전 요구 사항
Python 3.8 이상

Discord 봇 토큰

Google Gemini API 키

기상청 공공데이터포털 API 키 (선택 사항)

2. 설치
저장소 복제:

git clone <저장소_URL>
cd <프로젝트_디렉토리>

필요한 라이브러리 설치:
requirements.txt 파일에 모든 필요 라이브러리가 포함되어 있습니다.

pip install -r requirements.txt

3. 환경 변수 설정
프로젝트 루트 디렉토리에 .env 파일을 생성하고 아래 내용을 채워주세요.

# Discord 봇의 토큰
DISCORD_BOT_TOKEN="YOUR_DISCORD_BOT_TOKEN"

# Google Gemini API 키
GEMINI_API_KEY="YOUR_GEMINI_API_KEY"

# 기상청 공공데이터포털 일반 인증키 (Encoding)
KMA_API_KEY="YOUR_KMA_API_KEY"

4. config.py 핵심 설정 가이드
config.py 파일에서 봇의 거의 모든 행동을 제어할 수 있습니다.

AI_MODEL_NAME: 사용자의 질문에 답변을 생성하는 메인 AI 모델을 지정합니다. (기본: gemini-2.5-flash)

AI_INTENT_MODEL_NAME: 사용자의 의도를 분석하는 가벼운 AI 모델을 지정합니다. (기본: gemini-2.0-flash)

API_RPM_LIMIT, API_RPD_LIMIT: 두 모델 중 더 낮은 제한값을 기준으로 설정되어 있어 안전합니다.

CHANNEL_AI_CONFIG: 각 채널 ID별로 봇의 페르소나, 규칙, 활동 여부를 상세하게 설정할 수 있습니다.

AI_PROACTIVE_RESPONSE_CONFIG: 봇의 자발적 응답 기능에 대한 설정입니다.

keywords: 봇이 반응할 키워드를 지정합니다.

probability: 봇이 키워드를 감지했을 때 실제로 반응할 확률을 조절합니다. (0.0 ~ 1.0)

cooldown_seconds: 자발적 응답 후 다음 응답까지의 최소 대기 시간입니다.

FUN_KEYWORD_TRIGGERS: !운세, !요약 등의 기능을 키워드로 실행하기 위한 설정입니다.

ACTIVITY_DATA_FILE: 서버 활동 랭킹 데이터가 저장될 파일 이름입니다.

🔒 API 사용 및 안전장치
봇은 API 제한을 초과하지 않도록 여러 안전장치를 갖추고 있습니다.

중앙 API 관리: 모든 AI 호출은 ai_handler를 통해 이루어지며, 설정된 분당/하루 요청 횟수를 넘지 않도록 제어됩니다.

토큰 제한 방지: !요약 기능은 AI에게 대화록을 보내기 전 글자 수를 미리 체크하여, 토큰 제한을 초과할 가능성을 원천적으로 차단합니다.

쿨다운 시스템: 자발적 응답 및 키워드 기반 기능은 모두 쿨다운 시스템이 적용되어, 단시간에 반복적으로 실행되어 API를 낭비하는 것을 방지합니다.